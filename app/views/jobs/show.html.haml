= error_messages_for('bid')
.page.shadow
  .stripe
    .left
      .avatar
        - link_to user_url(@job.creator) do
          = image_tag @job.creator.image.url(:avatar)
      %h2
        = @job.title
      .info
        Job created on
        %span.highlight
          = format_time(@job.created_at, :datestamp)
        by
        =link_to @job.creator.name,user_url(@job.creator)
    .right
      %ul.context-menu
        - if can? :update, @job
          %li.edit
            = link_to 'Edit', edit_job_path(@job)
        -if can? :read_bids, @job
          %li.bids
            - link_to_block_if(@job.bids.count > 0, job_bids_url(@job)) do
              %span.bid-count
                = @job.bids.count
              Bids
    .clear
  .content.light
    .left
      .description
        .box
          %p
            = @job.description
        .specifications
          %table
            %tr
              %td.label.box
                Fabrication type:
              %td.attribute.box-inline
                = @job.fabrication_type
            %tr
              %td.label.box
                Quantity needed:
              %td.attribute.box-inline
                = @job.quantity_needed
            %tr
              %td.label.box
                Deliver to:
              %td.attribute.box-inline
                = @job.deliver_to
            %tr
              %td.label.box
                Deliver by:
              %td.attribute.box-inline
                = @job.deliver_by
      - if can? :new, @bid
        .callout
          .fold
          .content
            %h3
              LET'S MAKE A BID
            %div.bid_instructions
              %p
                Use the form below to submit your bid to the job owner. Be sure to include:
              %ul.things-to-remember
                %li
                  %strong
                    How much you will charge
                  (or if you're willing to trade or barter)
                %li
                  %strong
                    When you can deliver by
                %li
                  %strong
                    How you plan on delivering
                  (in person, in the mail, etc.)
              %p
                In the interest of keeping things honest, friendly and fun, you have
                %span.red
                  %strong
                    333
                characters to explain your bid:
            - form_for([@job, @bid], :html => {:class => 'place-a-bid'}) do |form|
              = form.hidden_field :job_id
              .message
                .stripe
                  .field-highlight.left.extra
                  %h4
                    TYPE YOUR MESSAGE HERE
                  .counter
                    222/333
                  .clear
                = form.text_area :message
              .quantity
                %label
                  .field-highlight.left
                  I can make
                  = form.text_field :quantity, :size => 2
                  copies of this object
                %br
                %span
                  = "Remember, #{@job.creator.name} asked for #{@job.quantity_needed} copies."
                %br
                %hr
              %p
                This bid is not a legal contract, only a semi-formal way of engaging in a conversation.
              %p.red
                By clicking the button below, the email address associated with your
                %strong
                  MAKERFACTORY
                account will be shared with the owner of this job.
              %input{:type=>"submit", :class=>"submit-bid", :value=>"Place bid"}
              .clear
      - elsif cannot? :create, @bid
        - if @job.creator == current_user
          - if (@job.bids.count > 0)
            .callout.link
          - else
            .callout

              .fold
              - link_to_block_if(@job.bids.count > 0, job_bids_url(@job)) do
                .content
                  %h3
                    THIS IS YOUR JOB!
                  %p
                    You created this job on
                    = format_time(@job.created_at, :human)
                    and so far
                    = pluralize(@job.bids.count, 'person has', 'people have')
                    have submitted bids. To view this job's bid history, click here.
                  .clear
        - else
          .callout
            .fold
            .content
              %h3
                YOU'VE BIDDED ON THIS JOB
              %div.bid_instructions
                %p
                  The job owner has your contact information and you will be notified by email if you are awarded the bid.
                %ul.things-to-remember
                  %li
                    You placed this bid on:
                    = format_time(@existing_bid.created_at, :human)
              - form_for([@job, @existing_bid], :html => {:class => 'place-a-bid'}) do |form|
                .message
                  .stripe
                    .left.extra
                    %h4
                      YOU SENT THIS MESSAGE
                    .clear
                  = form.text_area :message, :disabled => true
                .quantity
                  %label
                    Your bid was for a quantity of: 
                    = form.text_field :quantity, :size => 2, :disabled => true
                .clear
    .right
      .upload-image
        .bucket
          - [@job.image1, @job.image2, @job.image3].each do |image|
            = image_tag image.url(:profile) if image.file?
      .stripe
        %h4
          DOWNLOAD BLUEPRINTS
      .box
        %ul.file-list
          - if @job.blueprint.file?
            %li
              %h5
                = link_to(@job.blueprint.original_filename, @job.blueprint.url)
              %span.details
                = number_to_human_size @job.blueprint.size
    .clear

